import Vue from 'vue'
import VueRouter from 'vue-router'
Vue.use(VueRouter)
import routes from '@/router/routes'
import store from '@/store'
let originPush = VueRouter.prototype.push
let originReplace = VueRouter.prototype.replace
// 重写方法
Vue.prototype.push = function (location, resolve, reject) {
    if (resolve && reject) {
        originPush.call(this, location, resolve, reject)
    } else {
        originPush.call(this.location, () => { }, () => { })
    }
}
VueRouter.prototype.replace = function (location, resolve, reject) {
    if (resolve && reject) {
        originReplace.call(this, location, resolve, reject)
    } else {
        originReplace.call(this.location, () => { }, () => { })
    }
}
let router = new VueRouter({
    routes,
    scrollBehavior(to, from, savedPostion) {
        return { y: 0 }
    }
})
//路由守卫 
//全局前置守卫
// router.beforeEach(async (to, from, next) => {
//     //to:去的那个路由的信息
//     //from:从那个路由而来的信息
//     //next:放行函数!!!!!! 
//     //第一种：next(),放行函数，放行到它想去的路由！！！
//     //第二种:next(path),守卫指定放行到那个路由去?

//     //用户是否登录:取决于仓库里面是否有token！！！
//     //每一次路由跳转之前需要用有用户信息在跳转,没有发请求获取用户信息在跳转！！！！
//     //token
//     let hasToken = store.state.user.token;
//     //用户信息
//     let hasNickName = store.state.user.nickName;
//     //用户登录
//     if (hasToken) {
//         //用户登录了,不能去login
//         if (to.path == "/login") {
//             next('/home');
//         } else {
//             //用户登陆了,而且还有用户信息【去的并非是login】
//             if (hasNickName) {
//                 next();
//             } else {
//                 //用户登陆了,但是没有用户信息 
//                 try {
//                     //发请求获取用户信息以后在放行
//                     await store.dispatch('getUserInfo');
//                     next();
//                 } catch (error) {
//                     //用户没有信息，还携带token发请求获取用户信息【失败】
//                     //token【学生证失效了】
//                     //token失效:本地清空数据、服务器的token通知服务器清除
//                     await store.dispatch('logout');
//                     //回到登录页，重新获取一个新的学生证
//                     next('/login');
//                 }
//             }
//         }
//     } else {
//         //用户未登录||目前的判断都是放行
//         //用户未登录:不能进入/trade、/pay、/paysuccess、/center、/center/myorder  /center/teamorder

//         let toPath = to.path;
//         if (toPath.indexOf('trade') != -1 || toPath.indexOf('pay') != -1 || toPath.indexOf('center') != -1) {
//             next('/login?redirect=' + toPath);
//         } else {
//             next();
//         }
//     }
// });
export default router